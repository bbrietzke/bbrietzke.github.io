<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Installation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="installing-kubernetes"><a class="header" href="#installing-kubernetes">Installing Kubernetes</a></h1>
<p>This is for a single host installation.  I'll include instructions for adding an additional host down the line if you are so inclined.</p>
<p>I have consolidated a number of different documents, mostly for the troubleshooting.</p>
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<p>This is for installation on an Ubuntu 24.04 LTS machine.  I would recommend a machine with at least 8GiB of RAM, 16GiB of hard drive space and at least two cores.  The more the better things will run and the more stuff you can cram into Kubernetes.</p>
<p>Make sure your server is up to date before we get started.</p>
<pre><code>sudo apt update &amp;&amp; sudo apt full-upgrade -y 
</code></pre>
<h2 id="step-by-step"><a class="header" href="#step-by-step">Step By Step</a></h2>
<h3 id="step-one-disable-swap"><a class="header" href="#step-one-disable-swap">Step One: Disable Swap</a></h3>
<p><strong>Kubeadm</strong> will complain if swap is enabled, so let's disable able that.</p>
<pre><code>sudo swapoff -a
</code></pre>
<h3 id="step-two-kernel-parameters"><a class="header" href="#step-two-kernel-parameters">Step Two: Kernel Parameters</a></h3>
<p>There are some parameters that need to be tuned in the linux kernel for Kubernetes to work properly.</p>
<pre><code>sudo tee /etc/modules-load.d/containerd.conf &lt;&lt; EOF
overlay
br_netfilter
EOF
</code></pre>
<pre><code>sudo tee /etc/sysctl.d/kubernetes.conf &lt;&lt; EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
net.ipv6.conf.all.forwarding = 1
EOF
</code></pre>
<pre><code>sudo modprobe overlay &amp;&amp; sudo modprobe br_netfilter &amp;&amp; sudo sysctl --system
</code></pre>
<h3 id="step-three-container-runtime-installation"><a class="header" href="#step-three-container-runtime-installation">Step Three: Container Runtime Installation</a></h3>
<p>Let's install <strong>containerd</strong>.</p>
<pre><code>sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmour -o /etc/apt/trusted.gpg.d/docker.gpg &amp;&amp; \
sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" &amp;&amp; \
sudo apt update &amp;&amp; \
sudo apt install -y containerd.io
</code></pre>
<p>Need to have a configuration file for <strong>containerd</strong>.  Luckily, we can generate one.</p>
<pre><code>containerd config default | sudo tee /etc/containerd/config.toml &gt;/dev/null 2&gt;&amp;1 
sudo sed -i 's/SystemdCgroup \= false/SystemdCgroup \= true/g' /etc/containerd/config.toml
</code></pre>
<p>Then we'll need to enable and restart <strong>containerd</strong>.</p>
<pre><code>sudo systemctl enable containerd &amp;&amp; \
sudo systemctl restart containerd
</code></pre>
<h3 id="step-four-kubernetes-runtime-installation"><a class="header" href="#step-four-kubernetes-runtime-installation">Step Four: Kubernetes Runtime Installation</a></h3>
<p>This will install kubernetes 1.34 to be installed on the machine.  At the time of writing, it is the most current version.</p>
<pre><code>curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.34/deb/Release.key | sudo gpg  --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg &amp;&amp; \
echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.34/deb/ /" | sudo tee /etc/apt/sources.list.d/kubernetes.list &amp;&amp; \
sudo apt update &amp;&amp; \
sudo apt install -y kubelet kubeadm kubectl
</code></pre>
<h3 id="step-five-kubeadm-execution"><a class="header" href="#step-five-kubeadm-execution">Step Five: Kubeadm Execution</a></h3>
<p>Now for the part that we've all been waiting for! The prerequisites are in place so now it's time to get kubernetes up and running.</p>
<pre><code>sudo kubeadm init
</code></pre>
<p>This will take a little while to run.</p>
<h3 id="step-six-tool-configuration"><a class="header" href="#step-six-tool-configuration">Step Six: Tool Configuration</a></h3>
<p>Once the installation is complete, you will need to configure <strong>kubectl</strong>.  Execute the following:</p>
<pre><code>mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre>
<p>This will copy the configuration to your home directory.  This will allow you to use  <strong>kubectl</strong> from anywhere on the system.</p>
<h3 id="step-seven-remove-the-taints"><a class="header" href="#step-seven-remove-the-taints">Step Seven: Remove the Taints</a></h3>
<p>This is a single node system, which means that it's also running as a control panel.  Normally, kubernetes doesn't want additional pods on the control panel, which makes for an interesting catch-22.  Thankfully, we can fix that.</p>
<pre><code>kubectl taint nodes --all node-role.kubernetes.io/control-plane-
</code></pre>
<h3 id="step-eight-container-networking"><a class="header" href="#step-eight-container-networking">Step Eight: Container Networking</a></h3>
<p>In order for the node to become <em>ready</em>, it will need networking installed. For simple, one node installs I personally think Calico is perfectly reasonable.</p>
<pre><code>kubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.30.3/manifests/calico.yaml
</code></pre>
<p>It will take a little bit for the networking jitters to settle.</p>
<h3 id="step-nine-does-it-work"><a class="header" href="#step-nine-does-it-work">Step Nine: Does it work?</a></h3>
<p>Let's pull up the cluster information</p>
<pre><code>kubectl cluster-info
</code></pre>
<p>Do all nodes show <strong>READY</strong>?</p>
<pre><code>kubectl get nodes -o wide
</code></pre>
<p>What do the pods look like?</p>
<pre><code>kubectl get pods -o wide -A
</code></pre>
<h3 id="step-ten-install-something"><a class="header" href="#step-ten-install-something">Step Ten: Install Something!</a></h3>
<p>You can also create a very basic <em>nginx</em> deployment just to see if things work.</p>
<pre><code>kubectl apply -f https://gist.githubusercontent.com/bbrietzke/c59b6132c37ea36f9b84f1fee701a642/raw/952524cec7892e9db350fc62773c32ddfd9ab867/kubernetes-test.yaml
</code></pre>
<p>Then:</p>
<pre><code>open http://kubernetes-host.local:30081/
</code></pre>
<p>And you should see a website in the browser of your choice.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../kube/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../kube/local_setup.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../kube/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../kube/local_setup.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
